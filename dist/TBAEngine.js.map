{"version":3,"sources":["../src/TBAEngine.js"],"names":[],"mappings":";;AAAA,CAAC,YAAU;;AAGT,SAAO,SAAP,GAAmB,SAAS,SAAT,GAAoB;;AAErC,SAAK,WAAL,GAAmB,IAAnB;AACA,SAAK,KAAL,GAAa,EAAb;AACA,SAAK,cAAL,GAAsB,iBAAtB;AAED,GAND;;AAQA,YAAU,SAAV,GAAsB;AAEpB,SAFoB,iBAEd,KAFc,EAEP;AACX,UAAI,MAAM,EAAV;AACA,UAAI,QAAQ,MAAM,iBAAN,EAAZ;AACA,UAAI,gBAAgB,KAAK,cAAL,CAAoB,KAAK,cAAL,CAAoB,SAApB,CAA8B;AAAA,eAAG,EAAE,OAAF,CAAU,IAAV,CAAe,KAAf,CAAH;AAAA,OAA9B,CAApB,CAApB;AACA,UAAI,SAAS,KAAK,UAAL,CAAgB,KAAhB,CAAb;AACA,UAAI,gBAAgB,SAAQ,OAAO,OAAP,CAAe,OAAO,OAAP,CAAe,SAAf,CAAyB;AAAA,eAAG,EAAE,OAAF,CAAU,IAAV,CAAe,KAAf,CAAH;AAAA,OAAzB,CAAf,CAAR,GAA2E,SAA/F;;AAEA,UAAG,aAAH,EAAkB,IAAI,IAAJ,CAAS,cAAc,MAAd,CAAqB,IAArB,CAA0B,IAA1B,EAAgC,MAAhC,CAAT;AAClB,UAAG,aAAH,EAAkB,IAAI,IAAJ,CAAS,cAAc,MAAd,CAAqB,IAArB,CAA0B,MAA1B,EAAkC,IAAlC,CAAT;;AAElB,UAAG,IAAI,MAAP,EAAe,OAAO,IAAI,IAAJ,CAAS,GAAT,CAAP,CAAf,KACK,OAAO,KAAK,cAAZ;AAEN,KAfmB;AAiBpB,WAjBoB,mBAiBZ,UAjBY,EAiBA;AAClB,WAAK,KAAL,CAAW,WAAW,KAAtB,IAA+B,IAAI,IAAJ,CAAS,UAAT,CAA/B;AACD,KAnBmB;AAqBpB,cArBoB,sBAqBT,KArBS,EAqBF;AAChB,UAAI,YAAY,KAAK,WAAL,CAAiB,QAAjB,CAA0B,KAAK,WAAL,CAAiB,QAAjB,CAA0B,SAA1B,CAAoC,UAAS,CAAT,EAAW;AACvF,eAAO,KAAK,KAAL,CAAW,CAAX,EAAc,KAAd,CAAoB,IAApB,CAAyB,KAAzB,CAAP;AACD,OAF6E,CAE5E,IAF4E,CAEvE,KAAK,WAFkE,CAApC,CAA1B,CAAhB;;AAIA,aAAO,KAAK,WAAL,CAAiB,KAAjB,CAAuB,SAAvB,CAAP;AACD,KA3BmB;;;AA6BpB,oBAAiB,CACf,EAAC,SAAS,MAAV,EAAkB,MAAlB,oBAAiD;AAAA,YAAxB,MAAwB,uEAAjB,KAAK,WAAY;;AAC/C,eAAO,OAAO,MAAP,IAAiB,OAAO,cAAP,EAAxB;AACD;AAFD,KADe;;AA7BG,GAAtB;;AAuCA;;AAEA,WAAS,IAAT,CAAc,UAAd,EAA0B;AACxB,WAAO,MAAP,CAAc,IAAd,EAAoB,UAApB;AACA,SAAK,KAAL,GAAa,EAAb;AACD;;AAED,OAAK,SAAL,GAAiB;AAEf,WAFe,mBAEP,UAFO,EAEK;AAClB,WAAK,KAAL,CAAW,WAAW,GAAtB,IAA6B,IAAI,IAAJ,CAAS,UAAT,CAA7B;AACD,KAJc;AAMf,kBANe,4BAMC;AAAA;;AACZ,aAAO,KAAK,WAAL,GAAkB,GAAlB,GAAsB,KAAK,QAAL,CAAc,GAAd,CAAkB;AAAA,eAAG,MAAK,KAAL,CAAW,CAAX,EAAc,WAAjB;AAAA,OAAlB,EAAgD,IAAhD,CAAqD,GAArD,CAA7B;AACH;AARc,GAAjB;;AAYA,SAAO,cAAP,CAAsB,KAAK,SAA3B,EAAsC,UAAtC,EAAkD;AAChD,OADgD,iBAC3C;AAAE,aAAO,OAAO,IAAP,CAAY,KAAK,KAAjB,CAAP;AAAiC;AADQ,GAAlD;;AAKA;;AAEA,WAAS,IAAT,CAAc,UAAd,EAA0B;AACxB,WAAO,MAAP,CAAc,IAAd,EAAoB,UAApB;AACA,SAAK,KAAL,GAAa,IAAI,MAAJ,CAAW,WAAW,GAAtB,CAAb;AACA,SAAK,OAAL,GAAe,KAAK,OAAL,IAAgB,EAA/B;;AAGA,QAAI,OAAO,KAAK,MAAZ,KAAuB,UAA3B,EAAuC,OAAO,cAAP,CAAsB,IAAtB,EAA4B,QAA5B,EAAsC,EAAC,KAAI,KAAK,MAAV,EAAtC;AACvC,QAAI,OAAO,KAAK,WAAZ,KAA4B,UAAhC,EAA4C,OAAO,cAAP,CAAsB,IAAtB,EAA4B,aAA5B,EAA2C,EAAC,KAAI,KAAK,WAAV,EAA3C;AAC7C;;AAED,OAAK,SAAL,GAAiB;AAEf,kBAFe,4BAEC;AACd,aAAO,KAAK,WAAZ;AACD;AAJc,GAAjB;AAQD,CA9FD","file":"TBAEngine.js","sourcesContent":["(function(){\n\n\n  window.TBAEngine = function TBAEngine(){\n\n    this.currentRoom = null;\n    this.rooms = {};\n    this.invalidCommand = \"Invalid Command\";\n\n  }\n\n  TBAEngine.prototype = {\n\n    input(input) {\n      var ret = [];\n      var input = input.toLocaleLowerCase();\n      var globalCommand = this.globalCommands[this.globalCommands.findIndex(e=>e.command.test(input))];\n      var target = this.findTarget(input);\n      var targetCommand = target? target.actions[target.actions.findIndex(e=>e.command.test(input))]:undefined;\n\n      if(globalCommand) ret.push(globalCommand.method.call(this, target));\n      if(targetCommand) ret.push(targetCommand.method.call(target, this));\n\n      if(ret.length) return ret.join(\" \");\n      else return this.invalidCommand;\n      \n    },\n\n    addRoom(descriptor) {\n      this.rooms[descriptor.title] = new Room(descriptor);\n    },\n\n    findTarget(input) {\n      var targetKey = this.currentRoom.itemList[this.currentRoom.itemList.findIndex(function(e){\n        return this.items[e].regEx.test(input);\n      }.bind(this.currentRoom))];\n     \n      return this.currentRoom.items[targetKey];\n    },\n\n    globalCommands : [\n      {command: /look/, method(target=this.currentRoom){\n        return target.detail || target.getDescription();\n      }}\n    ]\n\n  };\n\n\n\n  // Room construction -------------\n\n  function Room(descriptor) {\n    Object.assign(this, descriptor);\n    this.items = {};\n  }\n\n  Room.prototype = {\n\n    addItem(descriptor) {\n      this.items[descriptor.key] = new Item(descriptor)\n    },\n\n    getDescription(){\n        return this.description +\" \"+this.itemList.map(x=>this.items[x].description).join(\" \");\n    }\n\n  };\n\n  Object.defineProperty(Room.prototype, 'itemList', {\n    get(){ return Object.keys(this.items); }\n  });\n\n\n  // Object construction --------------\n\n  function Item(descriptor) {\n    Object.assign(this, descriptor);\n    this.regEx = new RegExp(descriptor.key);\n    this.actions = this.actions || [];\n\n    \n    if (typeof this.detail === 'function') Object.defineProperty(this, 'detail', {get:this.detail});\n    if (typeof this.description === 'function') Object.defineProperty(this, 'description', {get:this.description});\n  }\n\n  Item.prototype = {\n\n    getDescription(){\n      return this.description;\n    }\n\n  }\n\n})();\n"]}