{"version":3,"sources":["../src/TBAEngine.js"],"names":[],"mappings":"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","file":"TBAEngine.js","sourcesContent":["(function(){\n  var directionMap = {\n    \"n\": \"north\",\n    \"s\": \"south\",\n    \"w\": \"west\",\n    \"e\": \"east\"\n  }\n\n  window.TBAEngine = function TBAEngine(){\n\n    this.currentRoom = null;\n    this.rooms = {};\n    this.inventory = {};\n    this.invalidCommand = \"Invalid Command\";\n    this.emptyInventory = \"Empy inventory\";\n    this.regExpMatchs = {};\n    this.conditions = [];\n\n  }\n\n  TBAEngine.prototype = {\n\n    input(input) {\n      var ret = [];\n      var output;\n\n      for (var i = 0, l = this.conditions.length; i < l; i++) {\n        var condition = this.conditions[i];\n        if(!condition.check.call(this)) ret.push(condition.failText);\n      }\n      if(ret.length) return ret.join(\" \");\n\n\n      var input = input.toLocaleLowerCase();\n      var globalCommand = this.globalCommands[this.globalCommands.findIndex(e=>e.command.test(input))];\n      var roomCommand = this.currentRoom.actions? this.currentRoom.actions[this.currentRoom.actions.findIndex(e=>e.command.test(input))]:undefined;\n      var target = this.findTarget(input);\n      var targetCommand = target && target.getCommand(input);\n\n      this.regExpMatchs.globalCommand = globalCommand? globalCommand.command.exec(input):null;\n      this.regExpMatchs.roomCommand = roomCommand? roomCommand.command.exec(input):null;\n      this.regExpMatchs.target = target? target.accessor.exec(input):null;\n      this.regExpMatchs.targetCommand = targetCommand? targetCommand.command.exec(input):null;\n\n      if(globalCommand) ret.push(globalCommand.method.call(this, target));\n      if(roomCommand) ret.push(roomCommand.method.call(this.currentRoom));\n      if(targetCommand) ret.push(targetCommand.method.call(target));\n\n      var output = ret.filter(function(n){ return !!n }).join(\" \");\n      return output.length? output:this.invalidCommand;\n    },\n\n    addCondition(condition) {\n      this.conditions.push(condition);\n    },\n\n    addRoom(descriptor) {\n      this.rooms[descriptor.title] = new Room(descriptor, this);\n    },\n\n    findTarget(input) {\n      var targetKey = this.currentRoom.itemList[this.currentRoom.itemList.findIndex(function(e){\n        return this.items[e].accessor.test(input);\n      }.bind(this.currentRoom))];\n\n      if(targetKey) return this.currentRoom.items[targetKey];\n\n      var targetKey = this.inventoryList[this.inventoryList.findIndex(function(e){\n        return this.inventory[e].accessor.test(input);\n      }.bind(this))];\n      return this.inventory[targetKey];\n    },\n\n    enterRoom(room){\n      this.currentRoom = room;\n      return room.getDescription();\n    },\n\n    dropItem(item){\n      if(this.inventory[item.key]){\n        this.currentRoom.addItem(item);\n        delete this.inventory[item.key]; \n      }\n    },\n\n    globalCommands : [\n      {command: /^look(.*)/, method(target){\n        if(!target) {\n          var query = this.regExpMatchs.globalCommand[1].trim();\n          if(query.length) return \"Nothing interesting\";\n          else target = this.currentRoom;\n        }\n        return target.detail || target.getDescription();\n      }},\n      {command: /^(go|g)\\s(.*)/, method(){\n        var direction = this.regExpMatchs.globalCommand[2];\n        if(/^[nesw]$/.test(direction)) direction = directionMap[direction];\n\n        for (var key in this.currentRoom.exits) {\n          if(this.currentRoom.exits.hasOwnProperty(key)) {\n            if(this.currentRoom.exits[key].accessor.test(direction)) return this.enterRoom(this.currentRoom.exits[key].room);\n          }\n        }\n\n        return \"Cannot go there.\";\n      }},\n      {command: /take/, method(target){\n        if(!target || !target.getCommand(\"take\")) return \"Cannot take that.\";\n        if(this.inventory[target.key]) return target.key+\" already taken\";\n      }},\n      {command: /^drop(.*)/, method(target){\n        if(!target) {\n          var query = this.regExpMatchs[1].trim();\n          if(!query.length) return \"Drop what?\";\n          else return \"You're not carrying that.\";\n        }\n        if(!target.getCommand(\"drop\")) {\n          if(!this.inventory[target.key]) return \"You're not carrying that.\";\n          else {\n            this.dropItem(target);\n            return target.key + \" dropped.\";\n          }\n        }\n      }},\n      {command: /inventory/, method(){\n        return this.inventoryList.length? this.inventoryList.join(\"\\n\"): this.emptyInventory;\n      }}\n    ]\n\n  };\n\n  Object.defineProperty(TBAEngine.prototype, \"inventoryList\", {\n    get(){return Object.keys(this.inventory)}\n  });\n\n\n\n  // Room construction -------------\n\n  function Room(descriptor, game) {\n    Object.assign(this, descriptor);\n    this.items = {};\n    this.exits = {};\n    this.game = game || null;\n  }\n\n  Room.prototype = {\n\n    addItem(descriptor) {\n      this.items[descriptor.key] = descriptor instanceof Item? descriptor:new Item(descriptor, this, this.game);\n      this.items[descriptor.key].room = this;\n      if(descriptor.init) descriptor.init.call(this.items[descriptor.key]);\n    },\n\n    addExit(discriptor) {\n      var key = discriptor.direction.toLocaleLowerCase()\n      this.exits[key] = discriptor;\n      this.exits[key].accessor = this.exits[key].accessor || new RegExp(key);\n    },\n\n    takeItem(item) {\n      this.game.inventory[item.key] = item;\n      delete item.room;\n      this.removeItem(item.key);\n    },\n\n    removeItem(key) {\n      delete this.items[key];\n    },\n\n    getDescription(){\n      var ret = [this.description];\n      ret = ret.concat(this.itemList.map(x=>this.items[x].description));\n      ret = ret.concat(this.exitList.map(x=>this.exits[x].description));\n      return ret.join(\" \");\n    }\n\n  };\n\n  Object.defineProperty(Room.prototype, 'itemList', {\n    get(){ return Object.keys(this.items); }\n  });\n\n  Object.defineProperty(Room.prototype, 'exitList', {\n    get(){ return Object.keys(this.exits); }\n  });\n\n\n  // Object construction --------------\n\n  function Item(descriptor, room, game) {\n    Object.assign(this, descriptor);\n\n    this.actions = this.actions || [];\n    this.accessor = this.accessor || new RegExp(this.key);\n    this.game = game || null;\n    this.room = room || null;\n\n    for (var i = 0, l = this.validGetters.length; i < l; i++) {\n      var e = this.validGetters[i];\n      if (typeof this[e] === 'function') Object.defineProperty(this, e, {get:this[e]});\n    }\n  }\n\n  Item.prototype = {\n\n    validGetters: ['detail', 'description', 'accessor'],\n\n    getDescription(){\n      return this.description;\n    },\n\n    getCommand(input){\n      return this.actions[this.actions.findIndex(e=>e.command.test(input))];\n    }\n\n  }\n\n})();\n"]}