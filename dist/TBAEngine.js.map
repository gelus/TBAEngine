{"version":3,"sources":["../src/TBAEngine.js"],"names":[],"mappings":"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","file":"TBAEngine.js","sourcesContent":["var validGetters = ['detail', 'description', 'accessor', 'name'];\n\nexport default function TBAEngine(){\n\n  this.actions = [];\n  this.conditions = [];\n  this.currentRoom = null;\n  this.emptyInventory = \"Empy inventory\";\n  this.invalidCommand = \"Invalid Command\";\n  this.invalidExit = \"Cannot go there\";\n  this.inventory = {};\n  this.rooms = {};\n\n};\n\nTBAEngine.prototype = {\n\n  input(input) {\n    var ret = [];\n    var output;\n\n    for (var i = 0, l = this.conditions.length; i < l; i++) {\n      var condition = this.conditions[i];\n      if(!condition.check.call(this)) ret.push(condition.failText);\n    }\n    if(ret.length) return ret.join(\" \");\n\n    var input = input.toLocaleLowerCase();\n\n    // get a list of targets including the game and current room\n    var targets = this.findTargets(input, [this,this.currentRoom]);\n\n    // call commands on targets\n    for (let i = 0, il = targets.length; i < il; i++) {\n      let target = targets[i];\n      if(!target.actions) continue;\n      for (let j = 0, jl = target.actions.length; j < jl; j++) {\n        let action = target.actions[j];\n        if (action.command.test(input)) {\n          target.regExpMatchs = {\n            target: target.accessor? target.accessor.exec(input):null,\n            command: action.command.exec(input)\n          };\n          ret.push(action.method.call(target));\n        }\n      }\n    }\n\n\n    var output = ret.filter(function(n){ return !!n }).join(\" \");\n    return output.length? output:this.invalidCommand;\n  },\n\n  addCondition(condition) {\n    this.conditions.push(condition);\n  },\n\n  addRoom(descriptor) {\n    this.rooms[descriptor.key] = new Room(descriptor, this);\n  },\n\n  createItem(descriptor) {\n    return new Item(descriptor, null, this);\n  },\n\n  findTargets(input, targets) {\n    return (targets || []).concat(\n      this.currentRoom.itemList.filter(e=>this.currentRoom.items[e].accessor.test(input)).map(e=>this.currentRoom.items[e]),\n      this.inventoryList.filter(e=>this.inventory[e].accessor.test(input)).map(e=>this.inventory[e])\n    );\n  },\n\n  findTarget(input) {\n    return this.findTargets(input)[0]\n  },\n\n  enterRoom(room) {\n    this.currentRoom = room;\n    return room.getDescription();\n  },\n\n  addGlobalCommand(descriptor) {\n    this.actions.push(descriptor);\n  },\n\n  removeGlobalCommand(input) {\n    var index = this.actions.findIndex(e => e.command.test(input));\n    this.actions.splice(index, 1);\n  }\n\n\n};\n\nObject.defineProperty(TBAEngine.prototype, \"inventoryList\", {\n  get(){return Object.keys(this.inventory)}\n});\n\nObject.defineProperty(TBAEngine.prototype, \"roomList\", {\n  get(){return Object.keys(this.rooms)}\n});\n\n// Room construction -------------\n\nfunction Room(descriptor, game) {\n  Object.assign(this, descriptor);\n  this.exits = {};\n  this.game = game || null;\n  this.items = {};\n\n  for (var i = 0, l = validGetters.length; i < l; i++) {\n    var e = validGetters[i];\n    if (typeof this[e] === 'function') Object.defineProperty(this, e, {get:this[e]});\n  }\n}\n\nRoom.prototype = {\n\n  addItem(descriptor) {\n    this.items[descriptor.key] = descriptor instanceof Item? descriptor:new Item(descriptor, this, this.game);\n    this.items[descriptor.key].room = this;\n    if(descriptor.init) descriptor.init.call(this.items[descriptor.key]);\n  },\n\n  addExit(discriptor) {\n    discriptor.accessor = discriptor.accessor || new RegExp(discriptor.key, \"i\");\n    this.exits[discriptor.key] = discriptor;\n  },\n\n  takeItem(item) {\n    this.game.inventory[item.key] = item;\n    delete item.room;\n    this.removeItem(item.key);\n  },\n\n  removeItem(key) {\n    delete this.items[key];\n  },\n\n  getDescription(){\n    var ret = [this.description];\n    ret = ret.concat(this.itemList.map(x=>this.items[x].description));\n    ret = ret.concat(this.exitList.map(x=>this.exits[x].description));\n    return ret.join(\" \");\n  }\n\n};\n\nObject.defineProperty(Room.prototype, 'itemList', {\n  get(){ return Object.keys(this.items); }\n});\n\nObject.defineProperty(Room.prototype, 'exitList', {\n  get(){ return Object.keys(this.exits); }\n});\n\n// Object construction --------------\n\nfunction Item(descriptor, room, game) {\n  Object.assign(this, descriptor);\n\n  this.accessor = this.accessor || new RegExp(this.key);\n  this.actions = this.actions || [];\n  this.game = game || null;\n  this.name = this.name || this.key;\n  this.room = room || null;\n\n  for (var i = 0, l = validGetters.length; i < l; i++) {\n    var e = validGetters[i];\n    if (typeof this[e] === 'function') Object.defineProperty(this, e, {get:this[e].bind(this)});\n  }\n}\n\nItem.prototype = {\n\n  getDescription(){\n    return this.description;\n  },\n\n  getCommand(input){\n    return this.actions[this.actions.findIndex(e=>e.command.test(input))];\n  },\n  \n  drop(){\n    if(this.game.inventory[this.key]){\n      this.game.currentRoom.addItem(this);\n      delete this.game.inventory[this.key]; \n    }\n  }\n\n}\n"]}