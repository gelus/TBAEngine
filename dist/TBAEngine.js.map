{"version":3,"sources":["../src/TBAEngine.js"],"names":[],"mappings":"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","file":"TBAEngine.js","sourcesContent":["(function(){\n\n  var validGetters = ['detail', 'description', 'accessor', 'name'];\n\n  window.TBAEngine = function TBAEngine(){\n\n    this.currentRoom = null;\n    this.rooms = {};\n    this.inventory = {};\n    this.invalidCommand = \"Invalid Command\";\n    this.invalidExit = \"Cannot go there\";\n    this.emptyInventory = \"Empy inventory\";\n    this.conditions = [];\n    this.actions = [];\n\n  };\n\n  TBAEngine.prototype = {\n\n    input(input) {\n      var ret = [];\n      var output;\n\n      for (var i = 0, l = this.conditions.length; i < l; i++) {\n        var condition = this.conditions[i];\n        if(!condition.check.call(this)) ret.push(condition.failText);\n      }\n      if(ret.length) return ret.join(\" \");\n\n      var input = input.toLocaleLowerCase();\n\n      // get a list of targets including the game and current room\n      var targets = this.findTargets(input, [this,this.currentRoom]);\n\n      // call commands on targets\n      for (let i = 0, il = targets.length; i < il; i++) {\n        let target = targets[i];\n        if(!target.actions) continue;\n        for (let j = 0, jl = target.actions.length; j < jl; j++) {\n          let action = target.actions[j];\n          if (action.command.test(input)) {\n            target.regExpMatchs = {\n              target: target.accessor? target.accessor.exec(input):null,\n              command: action.command.exec(input)\n            };\n            ret.push(action.method.call(target));\n          }\n        }\n      }\n\n\n      var output = ret.filter(function(n){ return !!n }).join(\" \");\n      return output.length? output:this.invalidCommand;\n    },\n\n    addCondition(condition) {\n      this.conditions.push(condition);\n    },\n\n    addRoom(descriptor) {\n      this.rooms[descriptor.key] = new Room(descriptor, this);\n    },\n\n    createItem(descriptor) {\n      return new Item(descriptor, null, this);\n    },\n\n    findTargets(input, targets) {\n      return (targets || []).concat(\n        this.currentRoom.itemList.filter(e=>this.currentRoom.items[e].accessor.test(input)).map(e=>this.currentRoom.items[e]),\n        this.inventoryList.filter(e=>this.inventory[e].accessor.test(input)).map(e=>this.inventory[e])\n      );\n    },\n    findTarget(input) {\n      return this.findTargets(input)[0]\n    },\n\n    enterRoom(room) {\n      this.currentRoom = room;\n      return room.getDescription();\n    },\n\n    addGlobalCommand(descriptor) {\n      this.actions.push(descriptor);\n    },\n\n    removeGlobalCommand(input) {\n      var index = this.actions.findIndex(e => e.command.test(input));\n      this.actions.splice(index, 1);\n    }\n\n\n  };\n\n  Object.defineProperty(TBAEngine.prototype, \"inventoryList\", {\n    get(){return Object.keys(this.inventory)}\n  });\n\n  Object.defineProperty(TBAEngine.prototype, \"roomList\", {\n    get(){return Object.keys(this.rooms)}\n  });\n\n  // Room construction -------------\n\n  function Room(descriptor, game) {\n    Object.assign(this, descriptor);\n    this.items = {};\n    this.exits = {};\n    this.game = game || null;\n\n    for (var i = 0, l = validGetters.length; i < l; i++) {\n      var e = validGetters[i];\n      if (typeof this[e] === 'function') Object.defineProperty(this, e, {get:this[e]});\n    }\n  }\n\n  Room.prototype = {\n\n    addItem(descriptor) {\n      this.items[descriptor.key] = descriptor instanceof Item? descriptor:new Item(descriptor, this, this.game);\n      this.items[descriptor.key].room = this;\n      if(descriptor.init) descriptor.init.call(this.items[descriptor.key]);\n    },\n\n    addExit(discriptor) {\n      discriptor.accessor = discriptor.accessor || new RegExp(discriptor.key, \"i\");\n      this.exits[discriptor.key] = discriptor;\n    },\n\n    takeItem(item) {\n      this.game.inventory[item.key] = item;\n      delete item.room;\n      this.removeItem(item.key);\n    },\n\n    removeItem(key) {\n      delete this.items[key];\n    },\n\n    getDescription(){\n      var ret = [this.description];\n      ret = ret.concat(this.itemList.map(x=>this.items[x].description));\n      ret = ret.concat(this.exitList.map(x=>this.exits[x].description));\n      return ret.join(\" \");\n    }\n\n  };\n\n  Object.defineProperty(Room.prototype, 'itemList', {\n    get(){ return Object.keys(this.items); }\n  });\n\n  Object.defineProperty(Room.prototype, 'exitList', {\n    get(){ return Object.keys(this.exits); }\n  });\n\n  // Object construction --------------\n\n  function Item(descriptor, room, game) {\n    Object.assign(this, descriptor);\n\n    this.actions = this.actions || [];\n    this.accessor = this.accessor || new RegExp(this.key);\n    this.name = this.name || this.key;\n    this.game = game || null;\n    this.room = room || null;\n\n    for (var i = 0, l = validGetters.length; i < l; i++) {\n      var e = validGetters[i];\n      if (typeof this[e] === 'function') Object.defineProperty(this, e, {get:this[e].bind(this)});\n    }\n  }\n\n  Item.prototype = {\n\n    getDescription(){\n      return this.description;\n    },\n\n    getCommand(input){\n      return this.actions[this.actions.findIndex(e=>e.command.test(input))];\n    },\n    \n    drop(){\n      if(this.game.inventory[this.key]){\n        this.game.currentRoom.addItem(this);\n        delete this.game.inventory[this.key]; \n      }\n    }\n\n  }\n\n})();\n"]}